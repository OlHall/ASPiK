<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASPiK SDK: Alter the PluginGUI Object</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ASPiK SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('cv5.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Alter the PluginGUI Object </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>With the object designed and the <a class="el" href="class_i_custom_view.html" title="Custom View interface to allow plugin core to create safe communication channels with GUI custom view...">ICustomView</a> interface implemented, you can turn your attention to the plugingui.cpp file. The function that is called to give the object the first opportunity to create a custom view is named createView( ): </p><div class="fragment"><div class="line">CView* PluginGUI::createView(<span class="keyword">const</span> UIAttributes&amp; attributes, <span class="keyword">const</span> IUIDescription* description)</div></div><!-- fragment --><p>The attributes and description arguments come from the GUI class factory that calls the method and contains all the information gleaned from the XML description file. One piece of that information is the custom view name, which is what we use to decode the data and instantiate the view. We’ve already setup a secondary function createUserCustomView( ) that will do some of the decoding work for you. You may either append your custom views to that function, or modify the function above. In the case of the waveform and spectrum views we’ll use the secondary function. For other controls, you will need to work inside of createView( ) where you can have access to all of the attribute and description information. You can see that this function is simple - we just decode the name string and then create a new object.</p>
<div class="fragment"><div class="line">CView* PluginGUI::createUserCustomView(std::string viewname, <span class="keyword">const</span> CRect rect,  IControlListener* listener, int32_t tag)</div><div class="line">{</div><div class="line">   <span class="keywordflow">if</span> (viewname.compare(<span class="stringliteral">&quot;CustomWaveView&quot;</span>) == 0)</div><div class="line">   {</div><div class="line">      <span class="comment">// --- create our custom view</span></div><div class="line">      <span class="keywordflow">return</span> <span class="keyword">new</span> WaveView(rect, listener, tag);</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div><div class="line">}</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --><p>The part of createView that calls this function is shown here. This is where the <a class="el" href="class_i_custom_view.html" title="Custom View interface to allow plugin core to create safe communication channels with GUI custom view...">ICustomView</a> pointer is obtained from the newly created object and safely sent to the plugin shell using the <a class="el" href="class_i_g_u_i_plugin_connector.html" title="Custom interface so that GUI can pass information to plugin shell in a thread-safe manner...">IGUIPluginConnector</a> interface pointer that it obtained during its creation:</p>
<div class="fragment"><div class="line"><span class="comment">// --- try a user view first</span></div><div class="line">CView* userCV = createUserCustomView(viewname, rect, listener, tag);</div><div class="line"><span class="keywordflow">if</span> (userCV)</div><div class="line">{</div><div class="line">   <span class="comment">// --- register custom view it with the plugin for updates</span></div><div class="line">   <span class="keywordflow">if</span> (hasICustomView(userCV))</div><div class="line">   {</div><div class="line">      <span class="keywordflow">if</span> (guiPluginConnector)</div><div class="line">         guiPluginConnector-&gt;<a class="code" href="class_steinberg_1_1_vst_1_1_a_s_pi_k_1_1_g_u_i_plugin_connector.html#ab8a48c15477002bb4fd4fe0a8a325dc8">registerCustomView</a>(viewname, dynamic_cast&lt;ICustomView*&gt;(userCV));</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="keywordflow">return</span> userCV;</div><div class="line">}</div><div class="line"><span class="comment">//</span></div><div class="line">@enecode</div><div class="line"></div><div class="line">In <span class="keyword">this</span> <span class="keywordflow">case</span>, the <a class="code" href="class_i_custom_view.html">ICustomView</a> is obtained by simply casting the custom view <span class="keywordtype">object</span> and that is registered with the <a class="code" href="class_i_g_u_i_plugin_connector.html">IGUIPluginConnector</a> interface. &lt;br&gt;</div><div class="line">&lt;br&gt;</div><div class="line">The SpectrumView <span class="keywordtype">object</span> is designed in a similar manner but uses a <span class="keywordtype">double</span>-ring-free-buffer scheme (mostly as an example) in its implementation. The &lt;strong&gt;createUserCustomView&lt;/strong&gt; <span class="keyword">function</span> is then modified to decode the custom view name <span class="stringliteral">&quot;CustomSpectrumView&quot;</span> and similarly creates and registers the custom view - see the demo project example <span class="keywordflow">for</span> all of the details.&lt;br&gt;</div><div class="line">&lt;br&gt;</div><div class="line">The custom knob view <span class="keywordtype">object</span> is designed by subclassing CAnimKnob from VSGUI4 and deriving it from <a class="code" href="class_i_custom_view.html">ICustomView</a> so that it exposes the interface. For the knob example, we are just going to show how to <span class="keyword">set</span> up a communication system with *ANY* custom view so it does not contain any specialized drawing code. We will simply <span class="stringliteral">&quot;talk&quot;</span> to the knob <span class="keywordtype">object</span> and <span class="keyword">get</span> a reply from it as proof of concept <span class="keywordflow">for</span> your own custom views. You can find the code that decodes, creates and registers <span class="keyword">this</span> custom knob in the &lt;strong&gt;PluginGUI::createView( )&lt;/strong&gt; <span class="keyword">function</span>, just below the portion of code that calls our added function &lt;strong&gt;createUserCustomView( )&lt;/strong&gt; above.&lt;br&gt;</div><div class="line">&lt;br&gt;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">*/</div><div class="line"></div></div><!-- fragment --><p>The next step is to pick up these pointers when the native plugin shell registers them with the plugin core object. This is done in the <a class="el" href="plugincore_8cpp.html" title="Implementation file for PluginCore object. ">plugincore.cpp</a> file inside of the <b><a class="el" href="class_plugin_core.html#adbc0df1ec8d13b5ed0540feadaab4c2f" title="For Custom View and Custom Sub-Controller Operations. ">PluginCore::processMessage( )</a> </b> which handles GUI events from the native plugin shell (don't worry, this is thread-safe). There are numerous messages that are decoded in this function, but we only need to deal with a couple of them:<br />
 <br />
 <b>PLUGINGUI_REGISTER_CUSTOMVIEW</b>: this message is sent once per custom view, each time the GUI is opened. Once you have stored a custom view interface pointer, you don't need to ever re-copy or re-store it. However this function WILL be called when the GUI is opened so you can use it (in part) to know a bit about the lifecycle of the GUI. <br />
 <br />
 <b>PLUGINGUI_TIMERPING</b>: this message is sent on every GUI update interval (50 msec) and is called from the GUI thread. This is where we will feed audio samples into the custom views and call the methods to update (repaint) these windows. Since this function is called from the GUI thread, we need that lock-free ring buffer on our plugin side to hold audio data from the audio processing thread.<br />
 <br />
 To pick up and store the interface pointers, you modify the code for the PLUGINGUI_REGISTER_CUSTOMVIEW to decode the incoming name string and store the pointer. This code is just for the two custom audio viewers; we'll address the custom knob later. User the example below to see how the pointers are passed into the message system - make sure you understand this if you want to modify it for your own custom messaging or other uses.</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> <a class="code" href="class_plugin_core.html#adbc0df1ec8d13b5ed0540feadaab4c2f">PluginCore::processMessage</a>(<a class="code" href="struct_message_info.html">MessageInfo</a>&amp; messageInfo)</div><div class="line">{</div><div class="line">   <span class="comment">// code snipped out</span></div><div class="line">   </div><div class="line">   <span class="keywordflow">case</span> PLUGINGUI_REGISTER_CUSTOMVIEW:</div><div class="line">   {</div><div class="line">      <span class="comment">// --- decode name string</span></div><div class="line">      <span class="keywordflow">if</span> (messageInfo.<a class="code" href="struct_message_info.html#ab0600e93ca0b692670c301a269d64c56">inMessageString</a>.compare(<span class="stringliteral">&quot;CustomWaveView&quot;</span>) == 0)</div><div class="line">      {</div><div class="line">         <span class="comment">// --- (1) get the custom view interface via incoming message data*</span></div><div class="line">         <span class="keywordflow">if</span> (waveView != static_cast&lt;ICustomView*&gt;(messageInfo.<a class="code" href="struct_message_info.html#a7a5400b80ef813190902ad1b96a20f72">inMessageData</a>))</div><div class="line">            waveView = static_cast&lt;ICustomView*&gt;(messageInfo.<a class="code" href="struct_message_info.html#a7a5400b80ef813190902ad1b96a20f72">inMessageData</a>);</div><div class="line"></div><div class="line">         <span class="keywordflow">if</span> (!waveView) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"></div><div class="line">         <span class="comment">// --- registered!</span></div><div class="line">         <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">      }</div><div class="line"></div><div class="line">      <span class="keywordflow">if</span> (messageInfo.<a class="code" href="struct_message_info.html#ab0600e93ca0b692670c301a269d64c56">inMessageString</a>.compare(<span class="stringliteral">&quot;CustomSpectrumView&quot;</span>) == 0)</div><div class="line">      {</div><div class="line">         <span class="comment">// --- (1) get the custom view interface via incoming message data*</span></div><div class="line">         <span class="keywordflow">if</span> (spectrumView != static_cast&lt;ICustomView*&gt;(messageInfo.<a class="code" href="struct_message_info.html#a7a5400b80ef813190902ad1b96a20f72">inMessageData</a>))</div><div class="line">            spectrumView = static_cast&lt;ICustomView*&gt;(messageInfo.<a class="code" href="struct_message_info.html#a7a5400b80ef813190902ad1b96a20f72">inMessageData</a>);</div><div class="line"></div><div class="line">         <span class="keywordflow">if</span> (!spectrumView) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"></div><div class="line">         <span class="comment">// --- registered!</span></div><div class="line">         <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">   }</div><div class="line"><span class="comment">//</span></div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">ASPiK Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="gui_design.html">Design a GUI</a></li><li class="navelem"><a class="el" href="define_g_u_i6.html">Advanced GUI Topics</a></li><li class="navelem"><a class="el" href="gui_designer11.html">Custom Views</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
