<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ASPiK SDK: Cache the ICustomView Pointers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ASPiK SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('cv6.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Cache the <a class="el" href="class_i_custom_view.html" title="Custom View interface to allow plugin core to create safe communication channels with GUI custom view...">ICustomView</a> Pointers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>With the PlugingGUI code modified to decode, create and register the custom views, we can add the last part to this project - picking up and saving the registered custom view interface pointers, and then using them to pump audio data into the views. We'll use the knob view to show how to talk to the objects.<br />
 <br />
 In the <a class="el" href="plugincore_8h.html" title="base class interface file for ASPiK plugincore object ">plugincore.h</a> file we declare some pointers to store the registered <a class="el" href="class_i_custom_view.html" title="Custom View interface to allow plugin core to create safe communication channels with GUI custom view...">ICustomView</a> interfaces. <b>Remember that ASPiK guarantees that these pointers will never go out of scope or become invalid after registration (the plugin shell objects handle this chore)</b>. In addition, the core object never needs (or is allowed) to delete these custom view interface pointers, so there is no added maintenance. You just register the pointers and use them - that's it. The pointers are added along with the rest of the user code in the declaration of the <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects. Note that you are fre to change the name of this object (as long as you change it in the compiler settings, etc...) ">PluginCore</a> object. We declare three pointers and one lock free ring buffer which will be used to store audio samples prior to their shipment out to the custom views. <br />
 <br />
 <b>class <a class="el" href="class_plugin_core.html" title="The PluginCore object is the default PluginBase derived object for ASPiK projects. Note that you are fre to change the name of this object (as long as you change it in the compiler settings, etc...) ">PluginCore</a> : public <a class="el" href="class_plugin_base.html" title="The PluginBase object is the base class for the Plugin Core object. ">PluginBase</a> </b><br />
 {<br />
 &emsp; // SNIPPPED code...<br />
 &emsp; // &mdash; BEGIN USER VARIABLES AND FUNCTIONS -----------------------------------&mdash; //<br />
 &emsp; // Add your variables and methods here<br />
 &emsp; // &mdash; custom view declarations<br />
 &emsp;<b> ICustomView* waveView = nullptr;</b><br />
 &emsp;<b> ICustomView* spectrumView = nullptr;</b><br />
 &emsp;<b> ICustomView* knobView = nullptr;</b><br />
 <br />
 &emsp; // &mdash; lock free ring buffer<br />
 &emsp;<b> moodycamel::ReaderWriterQueue&lt;float, 512&gt; customViewDataQueue;</b><br />
</p>
<p>}<br />
 <br />
</p>
<p>The next step is to pick up these pointers when the native plugin shell registers them with the plugin core object. This is done in the <a class="el" href="plugincore_8cpp.html" title="Implementation file for PluginCore object. ">plugincore.cpp</a> file inside of the <b><a class="el" href="class_plugin_core.html#adbc0df1ec8d13b5ed0540feadaab4c2f" title="For Custom View and Custom Sub-Controller Operations. ">PluginCore::processMessage( )</a> </b> which handles GUI events from the native plugin shell (don't worry, this is thread-safe). There are numerous messages that are decoded in this function, but we only need to deal with a couple of them:<br />
 <br />
 <b>PLUGINGUI_REGISTER_CUSTOMVIEW</b>: this message is sent once per custom view, each time the GUI is opened. Once you have stored a custom view interface pointer, you don't need to ever re-copy or re-store it. However this function WILL be called when the GUI is opened so you can use it (in part) to know a bit about the lifecycle of the GUI. <br />
 <br />
 <b>PLUGINGUI_TIMERPING</b>: this message is sent on every GUI update interval (50 msec) and is called from the GUI thread. This is where we will feed audio samples into the custom views and call the methods to update (repaint) these windows. Since this function is called from the GUI thread, we need that lock-free ring buffer on our plugin side to hold audio data from the audio processing thread.<br />
 <br />
 To pick up and store the interface pointers, you modify the code for the PLUGINGUI_REGISTER_CUSTOMVIEW to decode the incoming name string and store the pointer. This code is just for the two custom audio viewers; we'll address the custom knob later. User the example below to see how the pointers are passed into the message system - make sure you understand this if you want to modify it for your own custom messaging or other uses.<br />
 <br />
 <b>bool <a class="el" href="class_plugin_core.html#adbc0df1ec8d13b5ed0540feadaab4c2f" title="For Custom View and Custom Sub-Controller Operations. ">PluginCore::processMessage(MessageInfo&amp; messageInfo)</a></b><br />
 {<br />
 // code snipped out<br />
 <b>case PLUGINGUI_REGISTER_CUSTOMVIEW:</b><br />
 {<br />
 &emsp;// &mdash; decode name string<br />
 &emsp;<b>if (messageInfo.inMessageString.compare("CustomWaveView") == 0)</b><br />
 &emsp;{<br />
 &emsp;&emsp;// &mdash; (1) get the custom view interface via incoming message data*<br />
 &emsp;&emsp;<b>if (waveView != static_cast&lt;ICustomView*&gt;(messageInfo.inMessageData))</b><br />
 &emsp;&emsp;&emsp;<b>waveView = static_cast&lt;ICustomView*&gt;(messageInfo.inMessageData);</b><br />
 <br />
 &emsp; if (!waveView) return false;<br />
 <br />
 &emsp; // &mdash; registered!<br />
 &emsp; <b>return true;</b><br />
 &emsp; }<br />
 <br />
 &emsp;<b>if (messageInfo.inMessageString.compare("CustomSpectrumView") == 0)</b><br />
 &emsp;{<br />
 &emsp; // &mdash; (1) get the custom view interface via incoming message data*<br />
 &emsp;&emsp;<b>if (spectrumView != static_cast&lt;ICustomView*&gt;(messageInfo.inMessageData))</b><br />
 &emsp;&emsp;&emsp;<b>spectrumView = static_cast&lt;ICustomView*&gt;(messageInfo.inMessageData);</b><br />
 <br />
 &emsp;if (!spectrumView) return false;<br />
 <br />
 &emsp;// &mdash; registered!<br />
 &emsp;<b> return true;</b><br />
 &emsp;}<br />
 <br />
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">ASPiK Developer&#39;s Guide</a></li><li class="navelem"><a class="el" href="gui_design.html">Design a GUI</a></li><li class="navelem"><a class="el" href="define_g_u_i6.html">Advanced GUI Topics</a></li><li class="navelem"><a class="el" href="gui_designer11.html">Custom Views</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
